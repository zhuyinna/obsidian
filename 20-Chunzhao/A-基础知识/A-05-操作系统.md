## 硬件结构

### CPU cache
CPU Cache 用的是一种叫 **SRAM（_Static Random-Access_ Memory，静态随机存储器）** 的芯片。

SRAM 之所以叫「静态」存储器，是因为只要有电，数据就可以保持存在，而一旦断电，数据就会丢失了。

在 SRAM 里面，一个 bit 的数据，通常需要 6 个晶体管，所以 SRAM 的存储密度不高，同样的物理空间下，能存储的数据是有限的，不过也因为 SRAM 的电路简单，所以访问速度非常快。

下图注意：L3cache是多核心共享，而L1和L2是cpu核心独有的。
![[Pasted image 20240402112539.png|375]]
![[Pasted image 20240402113649.png|400]]

```ad-question
64 位相比 32 位 CPU 的优势在哪吗？64 位 CPU 的计算性能一定比 32 位 CPU 高很多吗？
```
- 64位的cpu一次能够对超过32位的数字进行运算，而32位的cpu如果运算的话需要分步，但是大部分时候不会用到那么高位的数字，所以只有在运算大数字的时候64位的优势才会体现出来。
- 64位：更大的物理寻址空间，2^48, 而32位：2^32 - 4G
```ad-question
你知道软件的 32 位和 64 位之间的区别吗？再来 32 位的操作系统可以运行在 64 位的电脑上吗？64 位的操作系统可以运行在 32 位的电脑上吗？如果不行，原因是什么？
```
32位和64位软件实际上代表的是不同指令是32还是64。
32软件要运行在64机器上，需要兼容机制。而64软件不能运行在32机器上。
>硬件的32位指的是CPU位宽，软件的32位指的是指令位宽。

### 内存
内存用的芯片和 CPU Cache 有所不同，它使用的是一种叫作 **DRAM （_Dynamic Random Access Memory_，动态随机存取存储器）** 的芯片。

## SSD/HDD
SSD（_Solid-state disk_） 就是我们常说的固体硬盘，结构和内存类似，但是它相比内存的优点是断电后数据还是存在的，而内存、寄存器、高速缓存断电后数据都会丢失。内存的读写速度比 SSD 大概快 `10~1000` 倍。

## 缓存一致性

### 写入方式
写直达 writethrough
写回 writeback：如果缓存命中，则标记为脏数据，暂时不写回内存。如果缓存不命中，需要和内存进行替换，如果为脏数据则写回，并读取新数据。

### 缓存不一致

因为写回没有立即修改内存，这时候其他cpu核读取内存会出现不一致。解决方法：
- 写传播
- 串行化（引入锁的概念）
基于总线嗅探机制的 MESI 协议，就满足上面了这两点，因此它是保障缓存一致性的协议。
MESI 协议，是已修改、独占、共享、已失效这四个状态的英文缩写的组合。整个 MSI 状态的变更，则是根据来自本地 CPU 核心的请求，或者来自其他 CPU 核心通过总线传输过来的请求，从而构成一个流动的状态机。另外，对于在「已修改」或者「独占」状态的 Cache Line，修改更新其数据不需要发送广播给其他 CPU 核心。
## cache的映射方式



#Todo 
redis缓存？![[Pasted image 20240402113945.png|275]]

